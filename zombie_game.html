<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ®­å±å°„æ“Šè¨“ç·´ - åµŒå…¥ç‰ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Noto+Sans+TC:wght@500;900&display=swap');

        :root {
            --primary-color: #ff3333;
        }

        /* æ”¹è‰¯é» 1: ä½¿ç”¨ 100% è€Œé 100vhï¼Œé©æ‡‰ iframe å¤§å° */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%; 
            height: 100%; 
            background-color: #0f0f13;
            background-image: 
                radial-gradient(#2a2a2a 1px, transparent 1px),
                radial-gradient(#1f1f1f 1px, transparent 1px);
            background-size: 30px 30px; /* æ ¼ç·šç¸®å° */
            overflow: hidden; /* å¼·åˆ¶éš±è—æ²è»¸ */
            font-family: 'Noto Sans TC', sans-serif;
            cursor: none; /* éš±è—é è¨­æ»‘é¼  */
            user-select: none;
            position: relative;
        }

        /* ç„æº–å™¨ç¨å¾®ç¸®å° */
        #cursor {
            position: fixed;
            width: 40px; /* 60 -> 40 */
            height: 40px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease-out;
            box-shadow: 0 0 10px var(--primary-color);
        }

        #cursor::before {
            content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background-color: var(--primary-color);
        }
        #cursor::after {
            content: ''; position: absolute; left: 50%; top: 0; width: 1px; height: 100%; background-color: var(--primary-color);
        }

        #cursor-dot {
            position: fixed;
            width: 4px; height: 4px;
            background-color: var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 10000;
        }

        /* åå­—ç¸®å°ä¸¦é é½Š */
        #player-name {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 14px; /* å­—é«”ç¸®å° */
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 15px;
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
            z-index: 20;
        }

        /* HUD ä»‹é¢å„ªåŒ– */
        .hud {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.8);
            padding: 5px 15px;
            border-radius: 6px;
            color: #fff;
            border: 1px solid #444;
            min-width: 80px;
            text-align: center;
        }

        .stat-label { font-size: 10px; color: #888; display: block; }
        .stat-value { font-size: 20px; font-weight: bold; font-family: monospace; }

        #time-value { color: #ffa500; }
        #time-value.danger { color: #ff3333; animation: pulse 0.5s infinite; }

        /* æ®­å±å¤§å°é©é… */
        .zombie {
            position: absolute;
            width: 60px;
            height: 60px;
            font-size: 50px; /* å­—é«”ç¸®å° 70 -> 50 */
            line-height: 60px;
            text-align: center;
            cursor: none;
            animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
            z-index: 5;
        }

        .zombie:active { transform: scale(0.9); }
        .zombie.dead { animation: die 0.2s forwards; pointer-events: none; }
        .score-popup { position: absolute; color: #ffd700; font-weight: bold; font-size: 20px; pointer-events: none; animation: floatUp 0.8s forwards; z-index: 6; }

        /* é¸å–®ç•«é¢å„ªåŒ– */
        #menu-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100;
        }

        /* æ¨™é¡Œä¸æœƒå¤§åˆ°çˆ†æ¡† */
        h1 {
            font-family: 'Creepster', cursive;
            color: var(--primary-color);
            font-size: 50px; /* 80 -> 50 */
            margin: 0 0 10px 0;
            text-shadow: 0 0 15px rgba(255, 51, 51, 0.5);
            letter-spacing: 3px;
            text-align: center;
        }

        p { font-size: 14px; color: #aaa; margin-bottom: 20px; }

        .btn {
            background: linear-gradient(45deg, #cc0000, #ff3333);
            border: none; padding: 10px 30px; color: white;
            font-size: 18px; border-radius: 50px;
            cursor: pointer; font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.4);
            transition: all 0.2s;
        }
        .btn:hover { transform: scale(1.05); }
        
        @keyframes popUp { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes die { 0% { transform: scale(1); } 50% { transform: scale(1.2); filter: brightness(2) hue-rotate(90deg); } 100% { transform: scale(0); opacity: 0; } }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-30px); opacity: 0; } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="cursor"></div>
    <div id="cursor-dot"></div>
    <div id="player-name">å‰µä½œè€…:æ¥ŠèŠ³ç‘œ</div>
    <div class="hud">
        <div class="stat-box">
            <span class="stat-label">æ™‚é–“</span><span id="time-value">30</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">åˆ†æ•¸</span><span id="score-value">0</span>
        </div>
    </div>
    <div id="game-area"></div>
    <div id="menu-screen">
        <h1>ZOMBIE SHOOTER</h1>
        <p>ä¿è­·åŸºåœ°ï¼30ç§’å…§æ¶ˆæ»…è¶Šå¤šæ®­å±è¶Šå¥½</p>
        <div id="final-score" style="color:white; font-size: 24px; margin-bottom: 15px; display:none;"></div>
        <button class="btn" onclick="game.start()">é–‹å§‹éŠæˆ²</button>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playShootSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = 'square'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }
        function playHitSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(400, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(600, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        const game = {
            score: 0, time: 30, isPlaying: false, timerInterval: null,
            gameArea: document.getElementById('game-area'),
            scoreDisplay: document.getElementById('score-value'),
            timeDisplay: document.getElementById('time-value'),
            menuScreen: document.getElementById('menu-screen'),
            finalScoreDisplay: document.getElementById('final-score'),
            zombieTypes: ['ğŸ§Ÿ', 'ğŸ§Ÿâ€â™‚ï¸', 'ğŸ§Ÿâ€â™€ï¸'],
            
            init: function() {
                // ä¿®æ­£ï¼šåœ¨ iframe ä¸­ mousemove éœ€è¦æ›´ç²¾ç¢º
                document.addEventListener('mousemove', (e) => {
                    const cursor = document.getElementById('cursor');
                    const dot = document.getElementById('cursor-dot');
                    // ç›´æ¥ä½¿ç”¨ clientX/Yï¼Œé€™åœ¨ iframe å…§éƒ¨æ˜¯ç›¸å°æ–¼ iframe å·¦ä¸Šè§’çš„
                    cursor.style.left = e.clientX + 'px';
                    cursor.style.top = e.clientY + 'px';
                    dot.style.left = e.clientX + 'px';
                    dot.style.top = e.clientY + 'px';
                });
                document.addEventListener('mousedown', () => {
                    if(this.isPlaying) {
                        playShootSound();
                        const cursor = document.getElementById('cursor');
                        cursor.style.transform = 'translate(-50%, -50%) scale(0.9)';
                        setTimeout(() => cursor.style.transform = 'translate(-50%, -50%) scale(1)', 50);
                    }
                });
            },
            start: function() {
                this.score = 0; this.time = 30; this.isPlaying = true;
                this.updateUI(); this.gameArea.innerHTML = '';
                this.menuScreen.classList.add('hidden');
                this.timeDisplay.classList.remove('danger');
                this.timerInterval = setInterval(() => {
                    this.time--; this.updateUI();
                    if(this.time <= 5) this.timeDisplay.classList.add('danger');
                    if (this.time <= 0) this.end();
                }, 1000);
                this.spawnLoop();
            },
            spawnLoop: function() {
                if (!this.isPlaying) return;
                this.spawnZombie();
                let nextSpawnTime = Math.random() * 800 + 400;
                if (this.time < 10) nextSpawnTime = Math.random() * 500 + 200;
                setTimeout(() => this.spawnLoop(), nextSpawnTime);
            },
            spawnZombie: function() {
                const zombie = document.createElement('div');
                zombie.classList.add('zombie');
                zombie.innerText = this.zombieTypes[Math.floor(Math.random() * this.zombieTypes.length)];
                
                // ä¿®æ­£ï¼šä½¿ç”¨ document.body.clientWidth ç¢ºä¿ä¸æœƒç”Ÿåœ¨æ¡†æ¡†å¤–
                const maxX = document.body.clientWidth - 60; 
                const maxY = document.body.clientHeight - 60;
                
                const randomX = Math.random() * (maxX - 20) + 10;
                const randomY = Math.random() * (maxY - 80) + 60; // é¿é–‹ HUD

                zombie.style.left = randomX + 'px';
                zombie.style.top = randomY + 'px';
                zombie.style.transform = `scale(${0.8 + Math.random() * 0.4})`; // ç¨å¾®ç¸®å° scale
                
                zombie.onmousedown = (e) => { e.stopPropagation(); this.hitZombie(zombie, e.clientX, e.clientY); };
                this.gameArea.appendChild(zombie);
                setTimeout(() => { if (zombie.parentNode && !zombie.classList.contains('dead')) zombie.remove(); }, 2000 + Math.random() * 1000);
            },
            hitZombie: function(element, x, y) {
                if (!this.isPlaying || element.classList.contains('dead')) return;
                playHitSound(); this.score++; this.updateUI();
                element.classList.add('dead'); this.showScorePopup(x, y);
                setTimeout(() => { if (element.parentNode) element.remove(); }, 200);
            },
            showScorePopup: function(x, y) {
                const popup = document.createElement('div');
                popup.innerText = "+1"; popup.classList.add('score-popup');
                popup.style.left = x + 'px'; popup.style.top = y + 'px';
                this.gameArea.appendChild(popup);
                setTimeout(() => popup.remove(), 800);
            },
            updateUI: function() { this.scoreDisplay.innerText = this.score; this.timeDisplay.innerText = this.time; },
            end: function() {
                this.isPlaying = false; clearInterval(this.timerInterval);
                this.menuScreen.classList.remove('hidden');
                this.finalScoreDisplay.style.display = 'block';
                this.finalScoreDisplay.innerText = `æ™‚é–“åˆ°ï¼ å¾—åˆ†: ${this.score}`;
            }
        };
        game.init();
    </script>
</body>
</html>
