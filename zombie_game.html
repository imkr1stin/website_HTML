<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ®­å±å°„æ“Šè¨“ç·´ - æ¥ŠèŠ³ç‘œ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Noto+Sans+TC:wght@500;900&display=swap');

        :root {
            --primary-color: #ff3333;
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: #0f0f13;
            background-image: 
                radial-gradient(#2a2a2a 1px, transparent 1px),
                radial-gradient(#1f1f1f 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px;
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            cursor: none; /* éš±è—é è¨­æ»‘é¼  */
            user-select: none;
        }

        /* è‡ªè¨‚ç„æº–å™¨ */
        #cursor {
            position: fixed;
            width: 60px;
            height: 60px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease-out;
            box-shadow: 0 0 10px var(--primary-color);
        }

        #cursor::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 1px;
            background-color: var(--primary-color);
        }

        #cursor::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            width: 1px;
            height: 100%;
            background-color: var(--primary-color);
        }

        #cursor-dot {
            position: fixed;
            width: 6px;
            height: 6px;
            background-color: var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 10000;
        }

        /* éŠæˆ²å€åŸŸ */
        #game-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* UI ä»‹é¢ */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ°éŠæˆ²å±¤ */
        }

        /* å·¦ä¸Šè§’åå­— */
        #player-name {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 900;
        }

        /* é ‚éƒ¨ HUD */
        .hud {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 25px;
            border-radius: 8px;
            color: #fff;
            font-size: 20px;
            border: 1px solid #444;
            min-width: 120px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            display: block;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
        }

        #time-value {
            color: #ffa500;
        }
        
        #time-value.danger {
            color: #ff3333;
            animation: pulse 0.5s infinite;
        }

        /* æ®­å±æ¨£å¼ */
        .zombie {
            position: absolute;
            width: 80px;
            height: 80px;
            font-size: 70px;
            line-height: 80px;
            text-align: center;
            cursor: none;
            user-select: none;
            animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
            transition: transform 0.1s;
            z-index: 5;
        }

        .zombie:active {
            transform: scale(0.9);
        }

        .zombie.dead {
            animation: die 0.2s forwards;
            pointer-events: none;
        }

        /* åˆ†æ•¸é£„å­— */
        .score-popup {
            position: absolute;
            color: #ffd700;
            font-weight: bold;
            font-size: 24px;
            pointer-events: none;
            animation: floatUp 0.8s forwards;
            z-index: 6;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* é¸å–®ç•«é¢ (é–‹å§‹/çµæŸ) */
        #menu-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            pointer-events: auto;
            backdrop-filter: blur(5px);
        }

        h1 {
            font-family: 'Creepster', cursive;
            color: var(--primary-color);
            font-size: 80px;
            margin: 0 0 20px 0;
            text-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
            letter-spacing: 5px;
        }

        .btn {
            background: linear-gradient(45deg, #cc0000, #ff3333);
            border: none;
            padding: 15px 50px;
            color: white;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
            transition: all 0.2s;
            text-transform: uppercase;
            margin-top: 20px;
            pointer-events: auto; /* ç¢ºä¿æŒ‰éˆ•å¯é»æ“Š */
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.6);
        }

        .btn:active {
            transform: scale(0.95);
        }

        #final-score {
            font-size: 32px;
            color: white;
            margin-bottom: 20px;
            display: none;
        }

        /* å‹•ç•« Keyframes */
        @keyframes popUp {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes die {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.2); filter: brightness(2) hue-rotate(90deg); }
            100% { transform: scale(0); opacity: 0; }
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .hidden {
            display: none !important;
        }

    </style>
</head>
<body>

    <!-- éŠæˆ²ç„æº–å™¨ -->
    <div id="cursor"></div>
    <div id="cursor-dot"></div>

    <!-- å·¦ä¸Šè§’åå­— -->
    <div id="player-name">å‰µä½œè€…:æ¥ŠèŠ³ç‘œ</div>

    <!-- HUD -->
    <div class="ui-layer">
        <div class="hud">
            <div class="stat-box">
                <span class="stat-label">æ™‚é–“</span>
                <span id="time-value" class="stat-value">30</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">åˆ†æ•¸</span>
                <span id="score-value" class="stat-value">0</span>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²äº’å‹•å€ -->
    <div id="game-area"></div>

    <!-- é¸å–®ç•«é¢ -->
    <div id="menu-screen">
        <h1>ZOMBIE SHOOTER</h1>
        <p style="color: #aaa; font-size: 18px; margin-bottom: 30px;">ä¿è­·åŸºåœ°ï¼30ç§’å…§æ¶ˆæ»…è¶Šå¤šæ®­å±è¶Šå¥½</p>
        <div id="final-score">æœ€çµ‚åˆ†æ•¸: 0</div>
        <button class="btn" onclick="game.start()">é–‹å§‹éŠæˆ²</button>
    </div>

    <script>
        // éŸ³æ•ˆç®¡ç†å™¨ (ä½¿ç”¨ Web Audio API ç”ŸæˆéŸ³æ•ˆï¼Œä¸éœ€å¤–éƒ¨æª”æ¡ˆ)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playShootSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playHitSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(600, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // éŠæˆ²é‚è¼¯
        const game = {
            score: 0,
            time: 30,
            isPlaying: false,
            timerInterval: null,
            spawnInterval: null,
            gameArea: document.getElementById('game-area'),
            scoreDisplay: document.getElementById('score-value'),
            timeDisplay: document.getElementById('time-value'),
            menuScreen: document.getElementById('menu-screen'),
            finalScoreDisplay: document.getElementById('final-score'),
            zombieTypes: ['ğŸ§Ÿ', 'ğŸ§Ÿâ€â™‚ï¸', 'ğŸ§Ÿâ€â™€ï¸'], // æ®­å± Emoji

            init: function() {
                // è‡ªè¨‚æ»‘é¼ è·Ÿéš¨
                document.addEventListener('mousemove', (e) => {
                    const cursor = document.getElementById('cursor');
                    const dot = document.getElementById('cursor-dot');
                    cursor.style.left = e.clientX + 'px';
                    cursor.style.top = e.clientY + 'px';
                    dot.style.left = e.clientX + 'px';
                    dot.style.top = e.clientY + 'px';
                });

                // å…¨å±€é»æ“Š (å°„æ“Šç©ºæ§)
                document.addEventListener('mousedown', () => {
                    if(this.isPlaying) {
                        playShootSound();
                        const cursor = document.getElementById('cursor');
                        cursor.style.transform = 'translate(-50%, -50%) scale(0.9)';
                        setTimeout(() => cursor.style.transform = 'translate(-50%, -50%) scale(1)', 50);
                    }
                });
            },

            start: function() {
                this.score = 0;
                this.time = 30;
                this.isPlaying = true;
                
                this.updateUI();
                this.gameArea.innerHTML = ''; // æ¸…ç©ºå ´æ™¯
                this.menuScreen.classList.add('hidden');
                this.timeDisplay.classList.remove('danger');
                
                // å•Ÿå‹•è¨ˆæ™‚å™¨
                this.timerInterval = setInterval(() => {
                    this.time--;
                    this.updateUI();
                    
                    if(this.time <= 5) {
                        this.timeDisplay.classList.add('danger');
                    }

                    if (this.time <= 0) {
                        this.end();
                    }
                }, 1000);

                // å•Ÿå‹•æ®­å±ç”Ÿæˆ (éš¨è‘—æ™‚é–“ç¨å¾®åŠ å¿«)
                this.spawnLoop();
            },

            spawnLoop: function() {
                if (!this.isPlaying) return;

                this.spawnZombie();

                // æ ¹æ“šå‰©é¤˜æ™‚é–“èª¿æ•´ç”Ÿæˆé€Ÿåº¦ï¼Œè¶Šå¾Œé¢è¶Šå¿«
                let nextSpawnTime = Math.random() * 800 + 400; // 0.4s - 1.2s
                if (this.time < 10) nextSpawnTime = Math.random() * 500 + 200;

                setTimeout(() => this.spawnLoop(), nextSpawnTime);
            },

            spawnZombie: function() {
                const zombie = document.createElement('div');
                zombie.classList.add('zombie');
                zombie.innerText = this.zombieTypes[Math.floor(Math.random() * this.zombieTypes.length)];
                
                // éš¨æ©Ÿä½ç½® (æ‰£é™¤é‚Šç•Œ)
                const maxX = window.innerWidth - 100;
                const maxY = window.innerHeight - 100;
                const randomX = Math.random() * (maxX - 100) + 50;
                const randomY = Math.random() * (maxY - 100) + 150; // é¿é–‹é ‚éƒ¨ HUD

                zombie.style.left = randomX + 'px';
                zombie.style.top = randomY + 'px';
                
                // éš¨æ©Ÿå¤§å°è®ŠåŒ–
                const scale = 0.8 + Math.random() * 0.5;
                zombie.style.transform = `scale(${scale})`;

                // é»æ“Šäº‹ä»¶
                zombie.onmousedown = (e) => {
                    e.stopPropagation(); // é˜²æ­¢è§¸ç™¼èƒŒæ™¯é»æ“Š
                    this.hitZombie(zombie, e.clientX, e.clientY);
                };

                this.gameArea.appendChild(zombie);

                // æ®­å±å­˜æ´»æ™‚é–“ï¼Œæ™‚é–“åˆ°è‡ªå‹•æ¶ˆå¤±
                setTimeout(() => {
                    if (zombie.parentNode && !zombie.classList.contains('dead')) {
                        zombie.remove();
                    }
                }, 2000 + Math.random() * 1000);
            },

            hitZombie: function(element, x, y) {
                if (!this.isPlaying || element.classList.contains('dead')) return;

                playHitSound();
                this.score++;
                this.updateUI();

                // è¦–è¦ºæ•ˆæœ
                element.classList.add('dead');
                this.showScorePopup(x, y);

                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (element.parentNode) element.remove();
                }, 200);
            },

            showScorePopup: function(x, y) {
                const popup = document.createElement('div');
                popup.innerText = "+1";
                popup.classList.add('score-popup');
                popup.style.left = x + 'px';
                popup.style.top = y + 'px';
                this.gameArea.appendChild(popup);
                
                setTimeout(() => popup.remove(), 800);
            },

            updateUI: function() {
                this.scoreDisplay.innerText = this.score;
                this.timeDisplay.innerText = this.time;
            },

            end: function() {
                this.isPlaying = false;
                clearInterval(this.timerInterval);
                
                this.menuScreen.classList.remove('hidden');
                this.finalScoreDisplay.style.display = 'block';
                this.finalScoreDisplay.innerText = `æ™‚é–“åˆ°ï¼ å¾—åˆ†: ${this.score}`;
                
                // é¡¯ç¤ºåŸæœ¬æ»‘é¼ ä»¥ä¾¿é»æ“ŠæŒ‰éˆ•
                // document.body.style.cursor = 'default';
            }
        };

        // åˆå§‹åŒ–
        game.init();

    </script>
</body>
</html>
